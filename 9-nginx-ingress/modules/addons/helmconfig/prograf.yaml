grafana:
  enabled: true
  admin:
    # Use a Kubernetes Secret for admin creds (create it once; see commands below)
#    existingSecret: grafana-admin
    userKey: "admin"
    passwordKey: "admin123"
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-staging
    hosts:
      - grafana-dev.mikeydevops1.online
    # (Optional) add TLS; uncomment if you want HTTPS for Grafana too
    # tls:
    # - secretName: grafana-general-tls
    #   hosts:
    #     - grafana-dev.mikeydevops1.online
  persistence:
    enabled: true
    size: 10Gi
  grafana.ini:
    security:
      allow_embedding: false
      disable_gravatar: true
      cookie_samesite: strict
    users:
      allow_sign_up: false

prometheus:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-staging
    hosts:
      - prometheus-dev.mikeydevops1.online
    tls:
      - secretName: prometheus-general-tls
        hosts:
          - prometheus-dev.mikeydevops1.online

  prometheusSpec:
    # keep defaults; add your extra scrape jobs
    additionalScrapeConfigs:
      # --- EC2 discovery: scrapes instances with tag "monitor=true" on port 9100
      - job_name: 'ec2-nodes'
        ec2_sd_configs:
          - region: us-east-1
            port: 9100
            filters:
              - name: "tag:monitor"
                values: ["true"]
        relabel_configs:
          - source_labels: [__meta_ec2_instance_id]
            target_label: instance_id
          - source_labels: [__meta_ec2_tag_Name]
            target_label: name

      # --- NGINX Ingress Controller metrics (ClusterDNS target)
      # If your controller runs in namespace "ingress-nginx" with service
      # "ingress-nginx-controller-metrics", use the FQDN below.
      # (Alternatively, expose a ServiceMonitor if the chart supports it.)
      - job_name: 'ingress'
        static_configs:
          - targets:
              - ingress-nginx-controller-metrics.ingress-nginx.svc.cluster.local:10254

alertmanager:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-staging
    hosts:
      - alertmanager-dev.mikeydevops1.online
    path: /
    tls:
      - secretName: alertmanager-general-tls
        hosts:
          - alertmanager-dev.mikeydevops1.online

  config:
    global:
      resolve_timeout: 5m
    inhibit_rules:
      - source_matchers:
          - 'severity = critical'
        target_matchers:
          - 'severity =~ warning|info'
        equal: ['namespace','alertname']
      - source_matchers:
          - 'severity = warning'
        target_matchers:
          - 'severity = info'
        equal: ['namespace','alertname']
      - source_matchers:
          - 'alertname = InfoInhibitor'
        target_matchers:
          - 'severity = info'
        equal: ['namespace']
      - target_matchers:
          - 'alertname = InfoInhibitor'
    route:
      group_by: ['namespace']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'null'
      routes:
        - receiver: 'null'
          matchers:
            - alertname = "Watchdog"
        - receiver: 'emails'
    receivers:
      - name: 'null'
      - name: 'emails'
        email_configs:
          - to: 'vinaybkrishna10@gmail.com'
            from: 'vinaybkrishna10@gmail.com'
            smarthost: 'email-smtp.us-east-1.amazonaws.com:587'
            auth_username: "admin"
            auth_password: "admin123"
            send_resolved: false
    templates:
      - '/etc/alertmanager/config/*.tmpl'
